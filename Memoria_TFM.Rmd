---
title: "Memoria_TFM"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Introduccion

El Trabajo Fin de Máster consistirá en analizar el impacto de diversos factores en el retraso de los vuelos.
Se añadiran datos climáticos al dataset de entrada y se estudiará el impacto del clima y del resto de variables sobre el retraso de los vuelos.
Para realizar el presente trabajo se utilizarán los lenguajes Python y R.

## 2. Análisis del dataset de entrada

A continuación se muestra un breve análisis de las variables del dataset de entrada:

```{r dataset, echo=FALSE}
vuelos <- read.table("operations_leg.csv", header = T, sep = "^")
```
```{r str}
str(vuelos)
```

Como se puede apreciar, el dataset de entrada esta compuesto por 222012 objetos y 65 variables.
Los tipos de las variables son variados, existiendo los siguientes: logi, int, num y factor.


```{r summary}
summary(vuelos)
```


Realizando el summary observamos lo siguiente:

* Varias variables únicamente almacenan valores NAs, por lo tanto deberan ser eliminadas.
* El codigo de aerolinea que más se utiliza es XX. Podemos entender no existía un código y se rellenó este campo con XX.
* La mayoría de vuelos tiene el valor **Departed** en su código de estado (variable general_status_code). 
* La mayoría de los vuelos despegan y aterrizan en aeropuertos Españoles.
* La máxima distancia de un vuelo son 9275 kilómetros y la mínima son 123 kilómetros.
* Existen vuelos que llegan a su destino con 59 minutos de adelanto así como existen vuelos que llegan a su destino con 59 minutos de retraso.
* Existen vuelos que despegan de su origen con 59 minutos de adelanto así como existen vuelos que despegan de su origen con 59 minutos de retraso.
* La media de piezas de equipajes en los aviones es de 61.

* Información sobre las fechas de los vuelos:
```{r lubridate,echo=FALSE,include=FALSE}
library(lubridate)
```


La siguiente gráfica muestra una relacion de los vuelos por año.
```{r año actual_time_of_arrival,out.width='100%'}
barplot(table(year(ymd_hms(vuelos$actual_time_of_departure))))
```
De la gráfica anterior se puede observar que los vuelos estan concentrados en el año 2016.
A continuación se indica el número de vuelos que se ha realizado cada año.
```{r tabla anyos}
table(year(ymd_hms(vuelos$actual_time_of_departure)))
```


La siguiente gráfica muestra la relacion entre los vuelos y los meses del año:
```{r mes actual_time_of_arrival, out.width='100%'}
barplot(table(month(ymd_hms(vuelos$actual_time_of_departure))))
```
De la gráfica anterior determinamos que los meses en los que más vuelos se hacen son Enero, Febrero y Marzo.


El siguiente boxplot muestra informacion de la distancia de los vuelos:
```{r distancia vuelo,out.width='100%'}
boxplot(vuelos$distance, main="Distancia vuelos")
summary(vuelos$distance)
```
Del boxplot anterior determinamos que la distancia media realizada en los vuelos es de 925 km.
El vuelo que menos distancia recorrio fueron 123 km y el vuelo que más distancia recorrio fueron 9275 km.


La siguiente gráfica muestra informacion sobre el retraso de llegada para los vuelos.
```{r retraso llegada,out.width='100%'}
boxplot(vuelos$arrival_delay, main="Retraso llegada")
summary(vuelos$arrival_delay)
```

Observando la gráfica anterior vemos que los retrasos de llegada de los vuelos se concentran entre -9 y 7 minutos.


Teniendo en cuenta esta primera observación de los datos en bruto, analizaremos cada variable con el fin de obtener el máximo de información posible antes de aplicar cualquier modelo.



## 3. Metodología a utilizar

3.1. La primera accion a tomar sera obtener el conjunto de datos a analizar. Para ello, nos fijamos en la variable **general status code**. Obtendremos aquellos registros cuyo valor para esta variable sea **Departed**.

3.2. El siguiente paso será limpiar los datos, analizar las variables de entrada, eliminar los NAs en el caso de ser posible, comprobar que los datos son correctos y crear nuevas variables en base a los datos existentes (siempre que sea posible y tenga sentido).

3.3 Se añadiran datos climaticos al dataset de entrada en funcion de las coordenadas geograficas.

Los pasos seguidos para el tratamiento de datos y para añadir datos climaticos se incluyen en los archivos adjuntos **DescripcionDatosEntrada_01.R, ScriptWeather.ipynb, DescripcionDatosEntrada_02.R**.

3.4. Se utilizaran diferentes algoritmos para determinar las variables que mas influyen en el retraso de los vuelos.
Aplicaremos regresion lineal, regresion logistica, ranfom forest y PCA. Se analizaran los resultados de cada algoritmo por separado y, finalmente, se hara una comparacion entre ellos.

3.5. Una vez determinado el mejor algoritmo analizaremos la relacion de las variables que forman el dataset con el retraso de los vuelos para determinar cual de ellas es más influyente

* Regresion Lineal

* Regresion Logistica

* Random Forest

* PCA

* Comparativa de los Modelos Anteriores

* Analisis de variables en funcion al retraso de los vuelos



## 4. Resumen de Resultados 

Una vez realizado el análisis del dataframe obtenemos los siguientes resultados:


